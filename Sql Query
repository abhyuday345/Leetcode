1757. Recyclable and Low Product

select product_id from products
where low_fats = 'Y' and recyclable = 'Y';

584. Find Customer Referee

select product_id from products
where low_fats = 'Y' and recyclable = 'Y';

595. Big Countries

SELECT name, population, area
FROM World
WHERE area >= 3000000
   OR population >= 25000000;

1148.Article Views I

select distinct(author_id) as 'id' from views
where author_id = viewer_id
order by author_id;

1683.Invalid Tweets

SELECT tweet_id
FROM Tweets
WHERE LENGTH(content) > 15;

1378. Replace Employee Id with new identifier

select unique_id,name from employees left join employeeuni on employees.id = employeeuni.id;

1068. Product Sales Analysis I

select product_name,year,price from sales s join 
product p on s.product_id = p.product_id;

1581. Customers who visited but did not make any transactions

select customer_id,count(*) as count_no_trans from visits v left join transactions t
on v.visit_id = t.visit_id
where transaction_id is null
group by customer_id;

197. Rising Temperature

SELECT id
FROM (
    SELECT 
        id,
        recordDate,
        temperature,
        LAG(temperature) OVER (ORDER BY recordDate) AS prev_temp,
        LAG(recordDate) OVER (ORDER BY recordDate) AS prev_date
    FROM Weather
) t
WHERE 
    temperature > prev_temp
    AND DATEDIFF(recordDate, prev_date) = 1;

1661. Average time of process per  minute

SELECT
    machine_id,
    round(avg(duration),3) AS processing_time
FROM (
    SELECT
        machine_id,
        process_id,
        MAX(CASE WHEN activity_type = 'end' THEN timestamp END) -
        MAX(CASE WHEN activity_type = 'start' THEN timestamp END) AS duration
    FROM activity
    GROUP BY machine_id, process_id
) t
GROUP BY machine_id;

577. Employee Bonus

select name,bonus from employee e left join bonus b on  
e.empid = b.empid
where bonus is null or bonus < 1000.

1280. Student and Examinations

SELECT 
    st.student_id,
    st.student_name,
    sub.subject_name,
    COUNT(e.subject_name) AS attended_exams
FROM students st
CROSS JOIN subjects sub
LEFT JOIN examinations e
    ON st.student_id = e.student_id
   AND sub.subject_name = e.subject_name
GROUP BY 
    st.student_id,
    st.student_name,
    sub.subject_name
ORDER BY 
    st.student_id,
    sub.subject_name;

570. Managers with at Least 5 Direct Reports

SELECT
    m.name
FROM employee e
JOIN employee m
    ON e.managerId = m.id
GROUP BY m.id, m.name
HAVING COUNT(e.id) >= 5;

1934.Confirmation Rate

SELECT 
    s.user_id,
    ROUND(
        IFNULL(
            SUM(c.action = 'confirmed') / COUNT(c.action),
            0
        ),
        2
    ) AS confirmation_rate
FROM Signups s
LEFT JOIN Confirmations c
ON s.user_id = c.user_id
GROUP BY s.user_id;

620.Not Boring Movies 

select * from cinema
where description != 'boring' and MOD(id, 2) = 1
order by rating desc;

1251.Average Selling Price

SELECT
    p.product_id,
    IFNULL(
        ROUND(SUM(p.price * u.units) / SUM(u.units), 2),
        0
    ) AS average_price
FROM Prices p
LEFT JOIN UnitsSold u
    ON p.product_id = u.product_id
   AND u.purchase_date BETWEEN p.start_date AND p.end_date
GROUP BY p.product_id;

1075. Project Employees I

select project_id,round(avg(experience_years),2) as 'average_years' from project p
join employee e
on p.employee_id = e.employee_id
group by project_id;


1633.Percentage of Users attended a contest

select contest_id,round(count(r.user_id)*100/(select count(*) from users),2)
as percentage from users u 
join register r 
on u.user_id = r.user_id
group by contest_id
order by percentage desc,contest_id;

1211.Queries Quality and Percentage

SELECT
  query_name,
  ROUND(AVG(rating / position), 2) AS quality,
  ROUND(AVG(rating < 3) * 100, 2) AS poor_query_percentage
FROM Queries
GROUP BY query_name;

1193.Monthly Transaction I

SELECT 
    DATE_FORMAT(trans_date, '%Y-%m') AS month,
    country,
    count(*) as trans_count,
    COUNT(CASE WHEN state = 'approved' THEN 1 END) AS approved_count,
    SUM(amount) AS trans_total_amount,
    SUM(
        CASE
            WHEN state = 'approved' THEN amount
            ELSE 0
        END
    ) AS approved_total_amount
FROM transactions
GROUP BY month,country;

1174. Immediate Food Delvery ||

SELECT
    ROUND(
        SUM(order_date = customer_pref_delivery_date) * 100.0 / COUNT(*),
        2
    ) AS immediate_percentage
FROM delivery
WHERE (customer_id, order_date) IN (
    SELECT customer_id, MIN(order_date)
    FROM delivery
    GROUP BY customer_id
);

550. Game Play Analysis IV

WITH cte AS (
    SELECT
        player_id,
        event_date,
        LEAD(event_date) OVER (
            PARTITION BY player_id
            ORDER BY event_date
        ) AS next_date,
        ROW_NUMBER() OVER (
            PARTITION BY player_id
            ORDER BY event_date
        ) AS rn
    FROM activity
)
SELECT
    ROUND(
        COUNT(DISTINCT CASE
            WHEN rn = 1 AND DATEDIFF(next_date, event_date) = 1
            THEN player_id
        END) / COUNT(DISTINCT player_id),
        2
    ) AS fraction
FROM cte;

2356. Number of Unique Subjects Taught by Each Teacher 

SELECT
    teacher_id,
    COUNT(DISTINCT subject_id) as cnt
FROM teacher
GROUP BY teacher_id;

1141 â€“ User Activity for the Past 30 Days

SELECT
    activity_date AS day,
    COUNT(DISTINCT user_id) AS active_users
FROM Activity
WHERE activity_date BETWEEN '2019-06-28' AND '2019-07-27'
GROUP BY activity_date;

1070. Product Sales Analysis III

SELECT
    s.product_id,
    s.year AS first_year,
    s.quantity,
    s.price
FROM sales s
JOIN (
    SELECT product_id, MIN(year) AS first_year
    FROM sales
    GROUP BY product_id
) t
ON s.product_id = t.product_id
AND s.year = t.first_year;

596.Classes with at Least 5 Students

select class
from courses
group by class
having count(*)>=5;

1729. Find Followers Count

SELECT
    user_id,
    COUNT(DISTINCT follower_id) AS followers_count
FROM followers
GROUP BY user_id;

619. Biggest Single Number

SELECT MAX(num) AS num
FROM MyNumbers
WHERE num IN (
    SELECT num
    FROM MyNumbers
    GROUP BY num
    HAVING COUNT(num) = 1
);

1045. Customers Who Bought All Products

SELECT customer_id
FROM Customer
GROUP BY customer_id
HAVING COUNT(DISTINCT product_key) = (
    SELECT COUNT(*) 
    FROM Product
);

1731. The Number of Employees Which Report to Each Employee

SELECT
    m.employee_id,
    m.name,
    COUNT(e.employee_id) AS reports_count,
    ROUND(AVG(e.age)) AS average_age
FROM employees m
JOIN employees e
    ON m.employee_id = e.reports_to
GROUP BY m.employee_id, m.name
ORDER BY m.employee_id;

1789 . Primary Department of Each Employee

SELECT employee_id, department_id
FROM (
    SELECT *, 
           COUNT(*) OVER(PARTITION BY employee_id) as dept_count
    FROM Employee
) t
WHERE primary_flag = 'Y' OR dept_count = 1;       

601. Triangle Judgement

SELECT *,
       CASE
           WHEN (x + y) > z
            AND (x + z) > y
            AND (y + z) > x
           THEN 'Yes'
           ELSE 'No'
       END AS triangle
FROM triangle;

180. Consecutive Numbers

# Write your MySQL query statement below
SELECT DISTINCT num AS ConsecutiveNums
FROM (
    SELECT num,
           LAG(num, 1) OVER (ORDER BY id) AS prev1,
           LAG(num, 2) OVER (ORDER BY id) AS prev2
    FROM Logs
) t
WHERE num = prev1
  AND num = prev2;

1164.Product Price at a given date

SELECT p.product_id,
       COALESCE(t.new_price, 10) AS price
FROM (
    SELECT DISTINCT product_id
    FROM products
) p
LEFT JOIN (
    SELECT product_id, new_price
    FROM (
        SELECT product_id, new_price,
               ROW_NUMBER() OVER (
                   PARTITION BY product_id
                   ORDER BY change_date DESC
               ) AS rn
        FROM products
        WHERE change_date <= '2019-08-16'
    ) x
    WHERE rn = 1
) t
ON p.product_id = t.product_id;

1204.Last Person to fit in the bus

SELECT person_name
FROM (
    SELECT
        turn,
        person_id AS id,
        person_name,
        weight,
        SUM(weight) OVER (ORDER BY turn) AS total_weight
    FROM queue
) t
WHERE total_weight <= 1000
ORDER BY turn DESC
LIMIT 1;

1907. Count Salary Categories

SELECT 
    c.category,
    COUNT(a.category) AS accounts_count
FROM (
    SELECT 'Low Salary' AS category
    UNION ALL
    SELECT 'Average Salary'
    UNION ALL
    SELECT 'High Salary'
    UNION ALL
    SELECT 'Invalid'
) c
LEFT JOIN (
    SELECT
        CASE
            WHEN income < 20000 THEN 'Low Salary'
            WHEN income BETWEEN 20000 AND 50000 THEN 'Average Salary'
            WHEN income > 50000 THEN 'High Salary'
            ELSE 'Invalid'
        END AS category
    FROM Accounts
) a
ON c.category = a.category
WHERE c.category <> 'Invalid'
GROUP BY c.category
ORDER BY accounts_count DESC;

1978. Employees Whose Manager Left the Company
SELECT e.employee_id
FROM employees e
LEFT JOIN employees s
ON e.manager_id = s.employee_id
WHERE s.employee_id IS NULL
AND e.manager_id IS NOT NULL
AND e.salary < 30000
order by e.employee_id;
626. Exchange Seats
SELECT
    id,
    CASE
        WHEN id % 2 = 1 AND id < (SELECT MAX(id) FROM seat)
            THEN LEAD(student) OVER (ORDER BY id)
        WHEN id % 2 = 0
            THEN LAG(student) OVER (ORDER BY id)
        ELSE student
    END AS student
FROM seat
ORDER BY id;



1341. Movie Rating
-- Get the top user by number of ratings
SELECT name AS results
FROM (
    SELECT
        u.name,
        COUNT(r.rating) AS cnt
    FROM users u
    JOIN movierating r ON u.user_id = r.user_id
    GROUP BY u.name
    ORDER BY cnt DESC, u.name
    LIMIT 1
) AS top_user
UNION ALL
-- Get the top movie by average rating for February 2020
SELECT title
FROM (
    SELECT
        m.title,
        AVG(r.rating) AS avg_rating
    FROM movies m
    JOIN movierating r ON m.movie_id = r.movie_id
    WHERE r.created_at >= '2020-02-01'
      AND r.created_at < '2020-03-01'
    GROUP BY m.title
    ORDER BY avg_rating DESC, m.title
    LIMIT 1
) AS top_movie;

1321.Restaurant Growth

WITH Dates AS (
  SELECT DISTINCT visited_on
  FROM Customer
  WHERE visited_on >= (
        SELECT DATE_ADD(MIN(visited_on), INTERVAL 6 DAY)
        FROM Customer
  )
)
SELECT
  Dates.visited_on,
  SUM(Customer.amount) AS amount,
  ROUND(SUM(Customer.amount) / 7, 2) AS average_amount
FROM Dates
LEFT JOIN Customer
  ON (DATEDIFF(Dates.visited_on, Customer.visited_on) BETWEEN 0 AND 6)
GROUP BY Dates.visited_on
ORDER BY Dates.visited_on;



602. Friend Requests II: Who Has the Most Friends


SELECT user_id as id, COUNT(*) AS num
FROM (
    SELECT accepter_id AS user_id
    FROM RequestAccepted
    UNION ALL
    SELECT requester_id AS user_id
    FROM RequestAccepted
) AS combined
GROUP BY user_id
order by num desc limit 1;


585. Investment in 2016

# Write your MySQL query statement below
SELECT ROUND(SUM(tiv_2016), 2) AS tiv_2016
FROM Insurance
WHERE tiv_2015 IN (
    SELECT tiv_2015
    FROM Insurance
    GROUP BY tiv_2015
    HAVING COUNT(*) > 1
)
AND (lat, lon) IN (
    SELECT lat, lon
    FROM Insurance
    GROUP BY lat, lon
    HAVING COUNT(*) = 1
);

185.Department of top 3 Salaries


SELECT
    d.name AS Department,
    e.name AS Employee,
    e.salary AS Salary
FROM (
    SELECT *,
           DENSE_RANK() OVER (
               PARTITION BY departmentId
               ORDER BY salary DESC
           ) AS rnk
    FROM Employee
) e
JOIN Department d
    ON e.departmentId = d.id
WHERE e.rnk <= 3;

1667. Fix Names in a Table

SELECT
  user_id,CONCAT(
    UPPER(LEFT(name, 1)),
    LOWER(SUBSTRING(name, 2))
  ) AS name
FROM users
order by user_id;



1527. Patients With a Condition


SELECT patient_id, patient_name, conditions
FROM Patients
WHERE conditions LIKE 'DIAB1%'
   OR conditions LIKE '% DIAB1%';


196. Delete Duplicate Emails

DELETE p1
FROM Person p1
JOIN Person p2
ON p1.email = p2.email
AND p1.id > p2.id;


176.Second Highest Salary 

SELECT
    (SELECT DISTINCT salary
     FROM employee
     ORDER BY salary DESC
     LIMIT 1 OFFSET 1) AS SecondHighestSalary;



1484. Group Sold Products By The Date

# Write your MySQL query statement below
SELECT
    sell_date,
    COUNT(DISTINCT product) AS num_sold,
    GROUP_CONCAT(DISTINCT product ORDER BY product SEPARATOR ',') AS products
FROM activities
GROUP BY sell_date;

1327. List the Products Ordered in a Period

# Write your MySQL query statement below
select product_name,sum(unit) as unit from products p
join orders o
on p.product_id = o.product_id
where order_date >='2020-02-01' and order_date <= '2020-02-29'
group by product_name
having sum(unit)>=100
;

1517. Find Users With Valid E-Mails

SELECT *
FROM Users
WHERE mail COLLATE utf8mb3_bin
REGEXP '^[A-Za-z][A-Za-z0-9_.-]*@leetcode\\.com$';


